"use strict";var x=Object.defineProperty,I=Object.defineProperties,H=Object.getOwnPropertyDescriptor,M=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertyNames,v=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var j=(s,e,t)=>e in s?x(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,l=(s,e)=>{for(var t in e||(e={}))R.call(e,t)&&j(s,t,e[t]);if(v)for(var t of v(e))N.call(e,t)&&j(s,t,e[t]);return s},d=(s,e)=>I(s,M(e));var m=(s,e)=>{var t={};for(var r in s)R.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&v)for(var r of v(s))e.indexOf(r)<0&&N.call(s,r)&&(t[r]=s[r]);return t};var B=(s,e)=>{for(var t in e)x(s,t,{get:e[t],enumerable:!0})},G=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of q(e))!R.call(s,a)&&a!==t&&x(s,a,{get:()=>e[a],enumerable:!(r=H(e,a))||r.enumerable});return s};var J=s=>G(x({},"__esModule",{value:!0}),s);var Q={};B(Q,{default:()=>w});module.exports=J(Q);var n=require("svelte/store");var F=["error","warn","debug"],O=({logger:s=console,level:e=F[1],prefix:t="[i18n]: "})=>F.reduce((r,a,o)=>d(l({},r),{[a]:i=>F.indexOf(e)>=o&&s[a](`${t}${i}`)}),{}),c=O({}),A=s=>{c=s};var z=g=>{var u=g,{parser:s,key:e,params:t,translations:r,locale:a,fallbackLocale:o}=u,i=m(u,["parser","key","params","translations","locale","fallbackLocale"]);if(!(e&&a))return c.warn("No translation key or locale provided. Skipping translation..."),"";let p=(r[a]||{})[e];return o&&p===void 0&&(p=(r[o]||{})[e]),i.hasOwnProperty("fallbackValue")&&p===void 0?i.fallbackValue:s.parse(p,t,a,e)},f=(...s)=>s.length?s.filter(e=>!!e).map(e=>{let t=`${e}`.toLowerCase();try{let[r]=Intl.Collator.supportedLocalesOf(e);if(!r)throw new Error(`'${e}' is non-standard.`);t=r}catch(r){c.warn(`Non-standard locale provided: '${e}'. Check your 'translations' and 'loaders' in i18n config...`)}return t}):[],S=(s,e)=>Object.keys(s||{}).reduce((t,r)=>{let a=s[r],o=e?`${e}.${r}`:`${r}`;return a&&typeof a=="object"?l(l({},t),S(a,o)):d(l({},t),{[o]:a})},{}),V=async s=>{try{return(await Promise.all(s.map(a=>{var o=a,{loader:t}=o,r=m(o,["loader"]);return new Promise(async i=>{let g;try{g=await t()}catch(u){c.error(`Failed to load translation. Verify your '${r.locale}' > '${r.key}' Loader.`),c.error(u)}i(d(l({loader:t},r),{data:g}))})}))).reduce((t,{key:r,data:a,locale:o})=>{if(!a)return t;let[i]=f(o);return d(l({},t),{[i]:S(d(l({},t[i]||{}),{[r]:a}))})},{})}catch(e){c.error(e)}return{}},$=s=>e=>{try{if(typeof e=="string")return e===s;if(typeof e=="object")return e.test(s)}catch(t){c.error("Invalid route config!")}return!1},E=(s,e)=>{let t=!0;try{t=Object.keys(s).filter(r=>s[r]!==void 0).every(r=>s[r]===e[r])}catch(r){}return t};var W=1e3*60*60*24,w=class{constructor(e){this.cachedAt=0;this.loadedKeys={};this.currentRoute=(0,n.writable)();this.config=(0,n.writable)();this.isLoading=(0,n.writable)(!1);this.promises=new Set;this.loading={subscribe:this.isLoading.subscribe,toPromise:(e,t)=>{let r=Array.from(this.promises).filter(a=>E({locale:f(e)[0],route:t},a)).map(({promise:a})=>a);return Promise.all(r)},get:()=>(0,n.get)(this.isLoading)};this.privateTranslations=(0,n.writable)({});this.translations={subscribe:this.privateTranslations.subscribe,get:()=>(0,n.get)(this.translations)};this.locales=d(l({},(0,n.derived)([this.config,this.privateTranslations],([e,t])=>{if(!e)return[];let{loaders:r=[]}=e,a=r.map(({locale:i})=>i),o=Object.keys(t).map(i=>i);return Array.from(new Set([...f(...a),...f(...o)]))},[])),{get:()=>(0,n.get)(this.locales)});this.internalLocale=(0,n.writable)();this.loaderTrigger=(0,n.derived)([this.internalLocale,this.currentRoute],([e,t],r)=>{var a,o;e!==void 0&&t!==void 0&&!(e===((a=(0,n.get)(this.loaderTrigger))==null?void 0:a[0])&&t===((o=(0,n.get)(this.loaderTrigger))==null?void 0:o[1]))&&(c.debug("Triggering translation load..."),r([e,t]))},[]);this.localeHelper=(0,n.writable)();this.locale={subscribe:this.localeHelper.subscribe,forceSet:this.localeHelper.set,set:this.internalLocale.set,update:this.internalLocale.update,get:()=>(0,n.get)(this.locale)};this.initialized=(0,n.derived)([this.locale,this.currentRoute,this.privateTranslations],([e,t,r],a)=>{(0,n.get)(this.initialized)||a(e!==void 0&&t!==void 0&&!!Object.keys(r).length)});this.translation=(0,n.derived)([this.privateTranslations,this.locale,this.isLoading],([e,t,r],a)=>{let o=e[t];o&&Object.keys(o).length&&!r&&a(o)},{});this.t=d(l({},(0,n.derived)([this.config,this.translation],a=>{var[o]=a,i=o,{parser:e,fallbackLocale:t}=i,r=m(i,["parser","fallbackLocale"]);return(g,...u)=>z(l({parser:e,key:g,params:u,translations:this.translations.get(),locale:this.locale.get(),fallbackLocale:t},r.hasOwnProperty("fallbackValue")?{fallbackValue:r.fallbackValue}:{}))})),{get:(e,...t)=>(0,n.get)(this.t)(e,...t)});this.l=d(l({},(0,n.derived)([this.config,this.translations],o=>{var[i,...g]=o,u=i,{parser:e,fallbackLocale:t}=u,r=m(u,["parser","fallbackLocale"]),[a]=g;return(p,T,...k)=>z(l({parser:e,key:T,params:k,translations:a,locale:p,fallbackLocale:t},r.hasOwnProperty("fallbackValue")?{fallbackValue:r.fallbackValue}:{}))})),{get:(e,t,...r)=>(0,n.get)(this.l)(e,t,...r)});this.getLocale=e=>{let{fallbackLocale:t=""}=(0,n.get)(this.config)||{},r=e||t;if(!r)return"";let a=this.locales.get();return a.find(i=>f(r).includes(i))||a.find(i=>f(t).includes(i))||""};this.setLocale=e=>{if(e&&e!==(0,n.get)(this.internalLocale))return c.debug(`Setting '${e}' locale.`),this.internalLocale.set(e),this.loading.toPromise(e,(0,n.get)(this.currentRoute))};this.setRoute=e=>{if(e!==(0,n.get)(this.currentRoute)){c.debug(`Setting '${e}' route.`),this.currentRoute.set(e);let t=(0,n.get)(this.internalLocale);return this.loading.toPromise(t,e)}};this.loadConfig=async e=>{await this.configLoader(e)};this.getTranslationProps=async(e=this.locale.get(),t=(0,n.get)(this.currentRoute))=>{let r=(0,n.get)(this.config);if(!r||!e)return[];let a=this.translations.get(),{loaders:o,fallbackLocale:i="",cache:g=W}=r||{},u=Number.isNaN(+g)?W:+g;this.cachedAt?Date.now()>u+this.cachedAt&&(c.debug("Refreshing cache."),this.loadedKeys={},this.cachedAt=0):(c.debug("Setting cache timestamp."),this.cachedAt=Date.now());let[p,T]=f(e,i),k=a[p],D=a[T],C=(o||[]).map(K=>{var L=K,{locale:h}=L,b=m(L,["locale"]);return d(l({},b),{locale:f(h)[0]})}).filter(({routes:h})=>!h||(h||[]).some($(t))).filter(({key:h,locale:b})=>b===p&&(!k||!(this.loadedKeys[p]||[]).includes(h))||i&&b===T&&(!D||!(this.loadedKeys[T]||[]).includes(h)));if(C.length){this.isLoading.set(!0),c.debug("Fetching translations...");let h=await V(C);this.isLoading.set(!1);let b=Object.keys(h).reduce((L,y)=>d(l({},L),{[y]:Object.keys(h[y])}),{}),K=C.filter(({key:L,locale:y})=>(b[y]||[]).some(P=>`${P}`.startsWith(L))).reduce((L,{key:y,locale:P})=>d(l({},L),{[P]:[...L[P]||[],y]}),{});return[h,K]}return[]};this.addTranslations=(e,t)=>{if(!e)return;c.debug("Adding translations...");let r=Object.keys(e||{});this.privateTranslations.update(a=>r.reduce((o,i)=>d(l({},o),{[i]:l(l({},o[i]||{}),S(e[i]))}),a)),r.forEach(a=>{let o=Object.keys(e[a]).map(i=>`${i}`.split(".")[0]);t&&(o=t[a]),this.loadedKeys[a]=Array.from(new Set([...this.loadedKeys[a]||[],...o||[]]))})};this.loader=async([e,t])=>{let r=this.getLocale(e);c.debug(`Adding loader promise for '${r}' locale and '${t}' route.`);let a=(async()=>{let o=await this.getTranslationProps(r,t);o.length&&this.addTranslations(...o)})();this.promises.add({locale:r,route:t,promise:a}),a.then(()=>{r&&this.locale.get()!==r&&this.locale.forceSet(r)})};this.loadTranslations=(e,t=(0,n.get)(this.currentRoute)||"")=>{let r=this.getLocale(e);if(r)return this.setRoute(t),this.setLocale(r),this.loading.toPromise(r,t)};this.loaderTrigger.subscribe(this.loader),this.isLoading.subscribe(async t=>{t&&this.promises.size&&(await this.loading.toPromise(),this.promises.clear(),c.debug("Loader promises have been purged."))}),e&&this.loadConfig(e)}async configLoader(e){if(!e)return c.error("No config provided!");let g=e,{initLocale:t,fallbackLocale:r,translations:a,log:o}=g,i=m(g,["initLocale","fallbackLocale","translations","log"]);o&&A(O(o)),[t]=f(t),[r]=f(r),c.debug("Setting config."),this.config.set(l({initLocale:t,fallbackLocale:r,translations:a},i)),a&&this.addTranslations(a),await this.loadTranslations(t)}};
